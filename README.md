# ğŸš€ VMQFox API - Goç‰ˆæœ¬ (å¤šç”¨æˆ·é«˜æ€§èƒ½ç‰ˆ)

åŸºäºGoè¯­è¨€é‡æ„çš„é«˜æ€§èƒ½RESTful APIæœåŠ¡ï¼Œæ›¿ä»£åŸæœ‰çš„ThinkPHPç‰ˆæœ¬ï¼Œæ–°å¢å¤šç”¨æˆ·æ”¯æŒå’Œä¼ä¸šçº§åŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ”¥ **é«˜æ€§èƒ½**: åŸºäºGo + Ginæ¡†æ¶ï¼Œå“åº”é€Ÿåº¦æå‡10å€ä»¥ä¸Š
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**: å¼ºç±»å‹è¯­è¨€ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- ğŸ‘¥ **å¤šç”¨æˆ·ç³»ç»Ÿ**: å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€æƒé™ç®¡ç†ã€æ•°æ®éš”ç¦»
- ğŸ” **JWTè®¤è¯**: ç°ä»£åŒ–çš„æ— çŠ¶æ€è®¤è¯æœºåˆ¶
- ğŸ¯ **æ™ºèƒ½è®¤è¯**: æ¡ä»¶è®¤è¯ä¸­é—´ä»¶ï¼Œè‡ªåŠ¨åŒºåˆ†å…¬å¼€/è®¤è¯è®¿é—®
- ğŸ“Š **ç»Ÿä¸€å“åº”**: æ ‡å‡†åŒ–çš„JSONå“åº”æ ¼å¼
- ğŸ³ **å®¹å™¨åŒ–**: æ”¯æŒDockeréƒ¨ç½²ï¼Œé•œåƒå°äº20MB
- ğŸ“ **å®Œæ•´æ–‡æ¡£**: APIæ–‡æ¡£å’Œå®ç°çŠ¶æ€å¯¹ç…§è¡¨
- âš¡ **å®šæ—¶ä»»åŠ¡**: å†…ç½®ç›‘æ§ç«¯çŠ¶æ€æ£€æŸ¥å’Œè®¢å•è¿‡æœŸå¤„ç†

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
vmqfox-api-go/
â”œâ”€â”€ cmd/server/          # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/         # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ handler/        # HTTPå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ auth.go     # è®¤è¯å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ user.go     # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ order.go    # è®¢å•ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ qrcode.go   # æ”¶æ¬¾ç ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ setting.go  # ç³»ç»Ÿè®¾ç½®
â”‚   â”‚   â”œâ”€â”€ menu.go     # èœå•ç®¡ç†
â”‚   â”‚   â””â”€â”€ payment.go  # æ”¯ä»˜é¡µé¢
â”‚   â”œâ”€â”€ service/        # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ repository/     # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ model/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â””â”€â”€ scheduler/      # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ jwt/           # JWTå·¥å…·
â”‚   â””â”€â”€ response/      # å“åº”æ ¼å¼
â”œâ”€â”€ config.yaml        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile         # Dockeré…ç½®
â”œâ”€â”€ go.mod            # Goæ¨¡å—æ–‡ä»¶
â””â”€â”€ API_USAGE_GUIDE.md # APIä½¿ç”¨æŒ‡å—
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- MySQL 5.7+
- Redis (å¯é€‰)

### 1. å…‹éš†é¡¹ç›®

```bash
cd vmqfox-api-go
```

### 2. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### 3. é…ç½®æ•°æ®åº“

ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š

```yaml
database:
  host: "localhost"
  port: 3306
  username: "root"
  password: "your_password"
  database: "vmqfox"
```

### 4. è¿è¡Œåº”ç”¨

```bash
# å¼€å‘æ¨¡å¼
go run cmd/server/main.go

# æˆ–è€…æ„å»ºåè¿è¡Œ
go build -o vmqfox-api cmd/server/main.go
./vmqfox-api
```

æœåŠ¡å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
Server starting on port 8000
```

### 5. æµ‹è¯•API

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8000/api/v2/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'

# ç”¨æˆ·æ³¨å†Œï¼ˆå¤šç”¨æˆ·åŠŸèƒ½ï¼‰
curl -X POST http://localhost:8000/api/v2/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"newuser","password":"123456","email":"newuser@example.com"}'
```

## ğŸ“‹ APIæ–‡æ¡£

### åŸºç¡€æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/health` | å¥åº·æ£€æŸ¥ |

### è®¤è¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/v2/auth/login` | ç”¨æˆ·ç™»å½• |
| POST | `/api/v2/auth/register` | ç”¨æˆ·æ³¨å†Œï¼ˆå¤šç”¨æˆ·åŠŸèƒ½ï¼‰ |
| POST | `/api/v2/auth/refresh` | åˆ·æ–°ä»¤ç‰Œ |
| GET | `/api/v2/me` | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ |
| POST | `/api/v2/logout` | ç”¨æˆ·æ³¨é”€ |

### ç”¨æˆ·ç®¡ç†æ¥å£ï¼ˆå¤šç”¨æˆ·ç³»ç»Ÿï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/users` | è·å–ç”¨æˆ·åˆ—è¡¨ | ç®¡ç†å‘˜ |
| POST | `/api/v2/users` | åˆ›å»ºç”¨æˆ· | ç®¡ç†å‘˜ |
| GET | `/api/v2/users/:id` | è·å–ç”¨æˆ·è¯¦æƒ… | ç®¡ç†å‘˜ |
| PUT | `/api/v2/users/:id` | æ›´æ–°ç”¨æˆ· | ç®¡ç†å‘˜ |
| DELETE | `/api/v2/users/:id` | åˆ é™¤ç”¨æˆ· | ç®¡ç†å‘˜ |
| PATCH | `/api/v2/users/:id/password` | é‡ç½®å¯†ç  | ç®¡ç†å‘˜ |

### è®¢å•ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/orders` | è·å–è®¢å•åˆ—è¡¨ | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/orders` | åˆ›å»ºè®¢å• | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/orders/:id` | è·å–è®¢å•è¯¦æƒ… | æ™ºèƒ½è®¤è¯ |
| PUT | `/api/v2/orders/:id` | æ›´æ–°è®¢å• | è®¤è¯ç”¨æˆ· |
| DELETE | `/api/v2/orders/:id` | åˆ é™¤è®¢å• | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/orders/:id/status` | æ£€æŸ¥è®¢å•çŠ¶æ€ | æ™ºèƒ½è®¤è¯ |
| PUT | `/api/v2/orders/:id/close` | å…³é—­è®¢å• | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/orders/:id/return-url` | ç”Ÿæˆå›è°ƒé“¾æ¥ | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/orders/close-expired` | æ‰¹é‡å…³é—­è¿‡æœŸè®¢å• | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/orders/delete-expired` | æ‰¹é‡åˆ é™¤è¿‡æœŸè®¢å• | è®¤è¯ç”¨æˆ· |

### å…¬å¼€APIï¼ˆç¬¬ä¸‰æ–¹å•†æˆ·ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| POST | `/api/public/order` | åˆ›å»ºè®¢å• |
| GET | `/api/public/order/:id` | è·å–è®¢å•è¯¦æƒ… |
| GET | `/api/public/order/:id/status` | æ£€æŸ¥è®¢å•çŠ¶æ€ |

### æ”¯ä»˜é¡µé¢APIï¼ˆå…¬å¼€è®¿é—®ï¼‰

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/public/orders/:id` | è·å–æ”¯ä»˜è®¢å•è¯¦æƒ… |
| GET | `/api/public/orders/:id/status` | æ£€æŸ¥æ”¯ä»˜çŠ¶æ€ |
| GET | `/api/public/orders/:id/return-url` | ç”Ÿæˆå›è°ƒé“¾æ¥ |

### æ”¶æ¬¾ç ç®¡ç†æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/qrcodes` | è·å–æ”¶æ¬¾ç åˆ—è¡¨ | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/qrcodes` | åˆ›å»ºæ”¶æ¬¾ç  | è®¤è¯ç”¨æˆ· |
| DELETE | `/api/v2/qrcodes/:id` | åˆ é™¤æ”¶æ¬¾ç  | è®¤è¯ç”¨æˆ· |
| PUT | `/api/v2/qrcodes/:id/status` | æ›´æ–°æ”¶æ¬¾ç çŠ¶æ€ | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/qrcodes/parse` | è§£ææ”¶æ¬¾ç  | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/qrcode/generate` | ç”ŸæˆäºŒç»´ç å›¾ç‰‡ | å…¬å¼€ |

### ç³»ç»Ÿè®¾ç½®æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/settings` | è·å–ç³»ç»Ÿé…ç½® | è®¤è¯ç”¨æˆ· |
| POST | `/api/v2/settings` | æ›´æ–°ç³»ç»Ÿé…ç½® | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/settings/monitor` | è·å–ç›‘æ§é…ç½® | è®¤è¯ç”¨æˆ· |
| PUT | `/api/v2/settings/monitor` | æ›´æ–°ç›‘æ§é…ç½® | è®¤è¯ç”¨æˆ· |

### ç³»ç»Ÿä¿¡æ¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/system/status` | ç³»ç»ŸçŠ¶æ€ | ç®¡ç†å‘˜ |
| GET | `/api/v2/system/info` | ç³»ç»Ÿä¿¡æ¯ | ç®¡ç†å‘˜ |
| GET | `/api/v2/system/update` | æ£€æŸ¥æ›´æ–° | ç®¡ç†å‘˜ |
| GET | `/api/v2/system/ip` | è·å–IPä¿¡æ¯ | ç®¡ç†å‘˜ |
| GET | `/api/v2/system/global-status` | å…¨å±€ç³»ç»ŸçŠ¶æ€ | ç®¡ç†å‘˜ |

### å…¶ä»–æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° | æƒé™ |
|------|------|------|------|
| GET | `/api/v2/dashboard` | æ•°æ®çœ‹æ¿ | è®¤è¯ç”¨æˆ· |
| GET | `/api/v2/menu` | èœå•æ¥å£ | è®¤è¯ç”¨æˆ· |

### ç›‘æ§ç«¯æ¥å£

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET/POST | `/api/v2/monitor/heart` | å¿ƒè·³æ£€æµ‹ |
| POST | `/api/v2/monitor/push` | ç›‘æ§æ¨é€ |

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡å™¨é…ç½®

```yaml
server:
  port: "8000"           # æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤8000ï¼‰
  mode: "debug"          # è¿è¡Œæ¨¡å¼: debug/release/test
  read_timeout: "30s"    # è¯»å–è¶…æ—¶
  write_timeout: "30s"   # å†™å…¥è¶…æ—¶
```

### æ•°æ®åº“é…ç½®

```yaml
database:
  driver: "mysql"
  host: "localhost"
  port: 3306
  username: "root"
  password: "password"
  database: "vmqfox"
  charset: "utf8mb4"
  max_idle_conns: 10
  max_open_conns: 100
  conn_max_lifetime: "1h"
```

### JWTé…ç½®

```yaml
jwt:
  secret: "your-secret-key"
  access_token_ttl: "2h"     # è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸ
  refresh_token_ttl: "168h"  # åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸ(7å¤©)
  issuer: "vmqfox"
```

## ğŸ³ Dockeréƒ¨ç½²

### æ„å»ºé•œåƒ

```bash
docker build -t vmqfox-api:latest .
```

### è¿è¡Œå®¹å™¨

```bash
docker run -d \
  --name vmqfox-api \
  -p 8000:8000 \
  -v $(pwd)/config.yaml:/root/config.yaml \
  vmqfox-api:latest
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ThinkPHPç‰ˆæœ¬ | Goç‰ˆæœ¬ | æå‡ |
|------|-------------|--------|------|
| å“åº”æ—¶é—´ | ~100ms | ~10ms | 90% â¬‡ï¸ |
| å†…å­˜ä½¿ç”¨ | ~50MB | ~10MB | 80% â¬‡ï¸ |
| å¹¶å‘å¤„ç† | ~100 req/s | ~1000 req/s | 900% â¬†ï¸ |
| Dockeré•œåƒ | ~200MB | ~20MB | 90% â¬‡ï¸ |
| å¯åŠ¨æ—¶é—´ | ~5s | ~1s | 80% â¬‡ï¸ |

## ğŸŒŸ å¤šç”¨æˆ·ç‰¹æ€§

### ç”¨æˆ·è§’è‰²ç³»ç»Ÿ
- **è¶…çº§ç®¡ç†å‘˜**: å®Œæ•´ç³»ç»Ÿç®¡ç†æƒé™
- **ç®¡ç†å‘˜**: ç”¨æˆ·ç®¡ç†å’Œç³»ç»Ÿé…ç½®æƒé™  
- **æ™®é€šç”¨æˆ·**: åŸºç¡€è®¢å•å’Œæ”¶æ¬¾ç ç®¡ç†æƒé™

### æ•°æ®éš”ç¦»
- æ¯ä¸ªç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- å®Œæ•´çš„æƒé™éªŒè¯å’Œæ•°æ®è¿‡æ»¤
- å®‰å…¨çš„å¤šç§Ÿæˆ·æ¶æ„

### æ³¨å†Œæµç¨‹
1. ç”¨æˆ·é€šè¿‡å‰ç«¯æ³¨å†Œé¡µé¢æäº¤ä¿¡æ¯
2. ç³»ç»ŸéªŒè¯é‚®ç®±å’Œç”¨æˆ·åå”¯ä¸€æ€§
3. è‡ªåŠ¨åˆ†é…æ™®é€šç”¨æˆ·è§’è‰²
4. æ”¯æŒç®¡ç†å‘˜åˆ›å»ºä¸åŒè§’è‰²ç”¨æˆ·

## ğŸ” æ™ºèƒ½è®¤è¯æœºåˆ¶

### æ¡ä»¶è®¤è¯ä¸­é—´ä»¶
ç³»ç»Ÿæ ¹æ®è¯·æ±‚è‡ªåŠ¨åˆ¤æ–­è®¿é—®ç±»å‹ï¼š

- **å…¬å¼€è®¿é—®**: æ”¯ä»˜é¡µé¢å’Œç¬¬ä¸‰æ–¹å•†æˆ·API
- **è®¤è¯è®¿é—®**: ç®¡ç†åå°åŠŸèƒ½
- **è‡ªåŠ¨è·¯ç”±**: ç›¸åŒAPIè·¯å¾„æ”¯æŒä¸åŒè®¤è¯æ–¹å¼

### è®¤è¯åˆ¤æ–­é€»è¾‘
```go
// æ”¯æŒæŸ¥è¯¢å‚æ•° ?public=true
if public := c.Query("public"); public == "true" {
    // å…¬å¼€è®¿é—®é€»è¾‘
}

// æ”¯æŒä¸“ç”¨å…¬å¼€è·¯å¾„
// /api/public/orders/* æ— éœ€è®¤è¯
// /api/v2/orders/* éœ€è¦è®¤è¯
```

## ğŸ•’ å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ

### è‡ªåŠ¨ä»»åŠ¡
- **ç›‘æ§ç«¯çŠ¶æ€æ£€æŸ¥**: å®šæœŸæ£€æŸ¥ç›‘æ§ç«¯åœ¨çº¿çŠ¶æ€
- **è¿‡æœŸè®¢å•å¤„ç†**: è‡ªåŠ¨å…³é—­å’Œæ¸…ç†è¿‡æœŸè®¢å•
- **ç³»ç»ŸçŠ¶æ€ç›‘æ§**: å®šæœŸæ”¶é›†ç³»ç»Ÿè¿è¡ŒçŠ¶æ€

### å¯åŠ¨æ—¥å¿—ç¤ºä¾‹
```
2025/07/28 23:05:47 å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨å¯åŠ¨
2025/07/28 23:05:47 ç›‘æ§ç«¯çŠ¶æ€æ£€æŸ¥å®šæ—¶ä»»åŠ¡å¯åŠ¨
2025/07/28 23:05:47 å®šæ—¶ä»»åŠ¡ï¼šå¼€å§‹æ£€æŸ¥ç›‘æ§ç«¯çŠ¶æ€
2025/07/28 23:05:47 å®šæ—¶ä»»åŠ¡ï¼šå¼€å§‹æ£€æŸ¥è¿‡æœŸè®¢å•
```

## ğŸ” å®ç°çŠ¶æ€

**å½“å‰è¿›åº¦**: 95%+ (åŸºç¡€åŠŸèƒ½å’Œå¤šç”¨æˆ·ç³»ç»Ÿå®Œæˆ)

**å·²å®ŒæˆåŠŸèƒ½**:
- âœ… ç”¨æˆ·è®¤è¯å’Œæ³¨å†Œ
- âœ… å¤šç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- âœ… è®¢å•ç®¡ç†ï¼ˆç»Ÿä¸€æ¥å£ï¼‰
- âœ… æ”¶æ¬¾ç ç®¡ç†
- âœ… ç³»ç»Ÿè®¾ç½®
- âœ… æ”¯ä»˜é¡µé¢API
- âœ… ç¬¬ä¸‰æ–¹å•†æˆ·API
- âœ… ç›‘æ§ç«¯æ¥å£
- âœ… å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
- âœ… æ™ºèƒ½è®¤è¯ä¸­é—´ä»¶

è¯¦ç»†çš„APIå®ç°çŠ¶æ€è¯·æŸ¥çœ‹ [API_USAGE_GUIDE.md](./API_USAGE_GUIDE.md)

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„API

1. åœ¨ `internal/model` ä¸­å®šä¹‰æ•°æ®æ¨¡å‹
2. åœ¨ `internal/repository` ä¸­å®ç°æ•°æ®è®¿é—®
3. åœ¨ `internal/service` ä¸­å®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨ `internal/handler` ä¸­å®ç°HTTPå¤„ç†
5. åœ¨ `cmd/server/main.go` ä¸­æ³¨å†Œè·¯ç”±

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ `gofmt` æ ¼å¼åŒ–ä»£ç 
- éµå¾ªGoè¯­è¨€å‘½åè§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¼–å†™å•å…ƒæµ‹è¯•
- ä½¿ç”¨ä¸­é—´ä»¶å¤„ç†é€šç”¨é€»è¾‘

### å¤šç”¨æˆ·å¼€å‘æ³¨æ„äº‹é¡¹

- æ‰€æœ‰æ•°æ®æŸ¥è¯¢éƒ½è¦åŠ ä¸Šç”¨æˆ·IDè¿‡æ»¤
- æƒé™æ£€æŸ¥é€šè¿‡ä¸­é—´ä»¶ç»Ÿä¸€å¤„ç†
- æ•°æ®åˆ›å»ºæ—¶è‡ªåŠ¨å…³è”å½“å‰ç”¨æˆ·
- æ•æ„Ÿæ“ä½œéœ€è¦ç®¡ç†å‘˜æƒé™éªŒè¯

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥å¸®åŠ©æ”¹è¿›é¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚
